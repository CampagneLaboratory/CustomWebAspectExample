package org.campagnelab.circles.model.web;

/*Generated by MPS */

import com.google.gwt.activity.shared.AbstractActivity;
import com.google.gwt.user.client.ui.HTML;
import java.util.logging.Logger;
import com.google.gwt.user.client.rpc.AsyncCallback;
import java.util.List;
import com.google.gwt.user.client.ui.AcceptsOneWidget;
import com.google.gwt.event.shared.EventBus;

public class ViewSearchNodesActivity extends AbstractActivity {
  protected final ClientFactory clientFactory;
  protected SearchNodes_WebModel model;
  protected SearchNodes_WebMapper mapper;
  protected HTML htmlWrapper = new HTML("<div/>");
  protected Logger logger = Logger.getLogger("ViewSearchNodesActivity");

  public ViewSearchNodesActivity(SearchNodesPlace place, ClientFactory factory) {
    // Get the factory reference 
    this.clientFactory = factory;
    logger.info("Creating activity" + "ViewSearchNodesActivity");
    model = new SearchNodes_WebModelImpl();
    // initialize properties from tokens if needed: 
    model.searchTerm.set(place.getToken_queryTerm());
    model.setClientFactory(clientFactory);
    {
      //  retrieve the list of beans with the DB service: 
      AsyncCallback<List<RootRef_Bean>> async = new AsyncCallback<List<RootRef_Bean>>() {
        @Override
        public void onFailure(Throwable caught) {
        }
        @Override
        public void onSuccess(List<RootRef_Bean> result) {
          // create a model for the bean and add it to the list: 
          model.results.clear();
          for (RootRef_Bean element : result) {
            model.results.add(RootRefToWebModel.transform(element, clientFactory));
          }
        }
      };
      clientFactory.getDbService().getListRootRef(place.getToken_queryTerm(), async);
    }
    mapper = new SearchNodes_WebMapper(model);
    mapper.attachRoot();
    htmlWrapper.getElement().appendChild(mapper.getTarget().getElement());

  }
  /**
   * Only used in MPS generator templates.
   */
  protected ViewSearchNodesActivity() {
    clientFactory = null;
  }
  @Override
  public String mayStop() {
    //  do not ask for confirmation when stopping 
    return null;
  }
  @Override
  public void onStop() {
    super.onStop();
  }
  @Override
  public void start(AcceptsOneWidget panel, EventBus eventBus) {
    // Attach this view to the application container 
    // sds $("#main").append 
    assert clientFactory != null : "NULL clientFactory";
    panel.setWidget(htmlWrapper);
    logger.info("Starting activity" + "ViewSearchNodesActivity");
  }
}
